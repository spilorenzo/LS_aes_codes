//
//  main.c
//  masked+prg_aes
//
//  Created by Lorenzo SPIGNOLI on 25/05/2023.
//

#include "test_functions.h"

int main(int argc, const char * argv[]) {
    
    srand(time(0));
    
    //state aes_state = {0x05,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02};
    //state aes_state1 = {0x05,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02};
    //state aes_state = {0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f};
    //state aes_state = {0xe3,0x38,0x2d,0x8e,0x60,0x8d,0x3e,0x38,0x15,0xf4,0xa7,0x88,0xe3,0xf4,0x06,0x1a};
    
    state aes_state = {0x54,0x77,0x6f,0x20,0x4f,0x6e,0x65,0x20,0x4e,0x69,0x6e,0x65,0x20,0x54,0x77,0x6f}; //for addroundkey[0]
    //state aes_state = {0x00,0x1f,0x0e,0x54,0x3c,0x4e,0x08,0x59,0x6e,0x22,0x1b,0x0b,0x47,0x74,0x31,0x1a}; //for subbyte
    //state aes_state = {0x63,0xc0,0xab,0x20,0xeb,0x2f,0x30,0xcb,0x9f,0x93,0xaf,0x2b,0xa0,0x92,0xc7,0xa2}; //for shiftrows
    //state aes_state = {0x63,0x2f,0xaf,0xa2,0xeb,0x93,0xc7,0x20,0x9f,0x92,0xab,0xcb,0xa0,0xc0,0x30,0x2b}; //for mixcolumns
    //state aes_state = {0xba,0x75,0xf4,0x7a,0x84,0xa4,0x8d,0x32,0xe8,0x8d,0x06,0x0e,0x1b,0x40,0x7d,0x5d}; // for addroundkey[1]
    //E2 32 FC F1 91 12 91 88 B1 59 E4 E6 D6 79 A2 93
    
    state aes_key = {0x54,0x68,0x61,0x74,0x73,0x20,0x6d,0x79,0x20,0x4b,0x75,0x6e,0x67,0x20,0x46,0x75};
    
    masked_state aes_state_shares, aes_key_shares;
    
    double time_spent1 = 0.0, time_spent2 = 0.0;
    
    encoding(aes_state, aes_state_shares);
    encoding(aes_key, aes_key_shares);
    
    clock_t begin1 = clock();
    
    aes_encryption_masked_table(aes_state_shares, aes_key_shares);
    
    clock_t end1 = clock();
    
    clock_t begin2 = clock();
    
    aes_encryption_masked(aes_state_shares, aes_key_shares);
    
    clock_t end2 = clock();
    
    time_spent1 += (double)(end1 - begin1) / CLOCKS_PER_SEC;
    time_spent2 += (double)(end2 - begin2) / CLOCKS_PER_SEC;
    
    printf("The elapsed time for the masked table is %f seconds\n", time_spent1);
    printf("The elapsed time for the rp masking is %f seconds\n", time_spent2);
    
    return 0;
}

